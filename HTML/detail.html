<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chi ti·∫øt si√™u xe</title>
  <link rel="stylesheet" href="../style/style.css">
  
  </head>
<body>
  <header>
    <h1>üèéÔ∏è Legendary Motosports</h1>
    <nav>
      <a href="index.html">Trang ch·ªß</a>
      <a href="about.html">Gi·ªõi thi·ªáu</a>
      <a href="login.html">ƒêƒÉng nh·∫≠p</a>
      <a href="manage.html">Qu·∫£n l√Ω xe</a>
    </nav>
  </header>

  <main id="car-detail" class="car-detail"></main>

  <div id="buy-popup" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h3>X√°c nh·∫≠n ƒê·∫∑t mua <span id="popup-car-name"></span></h3>
      <form id="buyForm">
        <div class="form-group">
          <label for="buyerName">T√™n c·ªßa b·∫°n:</label>
          <input type="text" id="buyerName" required>
        </div>
        <div class="form-group">
          <label for="buyerEmail">Email li√™n h·ªá:</label>
          <input type="email" id="buyerEmail" required>
        </div>
        <button type="submit" class="btn btn-buy-confirm">X√°c nh·∫≠n mua</button>
      </form>
    </div>
  </div>
  <script type="module">
    // ‚úÖ Import Firebase Modular (v10+)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // üî• C·∫•u h√¨nh Firebase (Gi·ªØ nguy√™n t·ª´ c√°c file kh√°c)
    const firebaseConfig = {
      apiKey: "AIzaSyABalL-liOEB5174fDeJ0OWNrg_xfA1APU",
      authDomain: "legendary-motosports-864b3.firebaseapp.com",
      projectId: "legendary-motosports-864b3",
      storageBucket: "legendary-motosports-864b3.firebasestorage.app",
      messagingSenderId: "960257570446",
      appId: "1:960257570446:web:81bfc9a97664bd422a3bdf",
      measurementId: "G-4XRBSRC96D"
    };

    // ‚öôÔ∏è Kh·ªüi t·∫°o Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const carDetail = document.getElementById("car-detail");
    
    // üîç L·∫•y ID xe t·ª´ URL query parameter (?id=...) thay v√¨ localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const carId = urlParams.get('id');
    
    // Logic Popup elements
    const buyPopup = document.getElementById("buy-popup");
    const closeBtn = document.querySelector(".close-btn");
    const popupCarName = document.getElementById("popup-car-name");
    const buyForm = document.getElementById("buyForm");

    // Th√™m Listener cho n√∫t mua sau khi n√≥ ƒë∆∞·ª£c render
    function setupBuyButtonListener(carName) {
        const buyButton = document.getElementById("buyButton");
        if (buyButton) {
            buyButton.addEventListener('click', () => {
                popupCarName.textContent = carName; // C·∫≠p nh·∫≠t t√™n xe
                buyPopup.style.display = "block";
                buyForm.setAttribute('data-current-car', carName);
            });
        }
    }


    async function loadDetail() {
      if (!carId) {
        carDetail.innerHTML = "<p style='text-align: center; color: red; padding: 20px;'>‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y ID xe!</p>";
        return;
      }

      try {
        // ‚úÖ S·ª≠ d·ª•ng c√∫ ph√°p Modular SDK (v10+)
        const docRef = doc(db, "xe", carId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          carDetail.innerHTML = `
            <div class="detail-container">
              <img src="${data.linkAnh || '../image/no-image.png'}" alt="${data.ten}">
              <div class="info">
                <h2>${data.ten}</h2>
                <p><b>Lo·∫°i:</b> ${data.loai || 'Kh√¥ng x√°c ƒë·ªãnh'}</p>
                <p><b>Gi√°:</b> ${data.gia || 'Li√™n h·ªá'}</p>
                <p><b>M√¥ t·∫£:</b> ${data.moTa || 'Ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt.'}</p>
                <button id="buyButton" data-car-name="${data.ten}" style="margin-top:15px; background:#4CAF50; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; color:white; font-weight:bold;">ƒê·∫∑t mua ngay</button>
              </div>
            </div>
          `;
          setupBuyButtonListener(data.ten); // G·ªçi sau khi render xong
        } else {
          carDetail.innerHTML = "<p style='text-align: center; color: orange; padding: 20px;'>‚ö†Ô∏è Xe n√†y kh√¥ng t·ªìn t·∫°i!</p>";
        }
      } catch (error) {
          console.error("L·ªói khi t·∫£i d·ªØ li·ªáu chi ti·∫øt:", error);
          carDetail.innerHTML = "<p style='text-align: center; color: red; padding: 20px;'>‚ùå L·ªói k·∫øt n·ªëi Firebase!</p>";
      }
    }

    loadDetail();
    
    // ‚úÖ Logic Popup (Cont.)
    
    // ƒê√≥ng popup khi click v√†o X
    if (closeBtn) {
        closeBtn.onclick = function() {
            buyPopup.style.display = "none";
            buyForm.reset();
        }
    }

    // ƒê√≥ng popup khi click ra ngo√†i
    window.onclick = function(event) {
        if (event.target == buyPopup) {
            buyPopup.style.display = "none";
            buyForm.reset();
        }
    }

    // X·ª≠ l√Ω Form X√°c nh·∫≠n
    buyForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const carName = buyForm.getAttribute('data-current-car');
        const name = document.getElementById("buyerName").value.trim();
        const email = document.getElementById("buyerEmail").value.trim();

        if (name && email) {
            // Thay th·∫ø b·∫±ng logic l∆∞u d·ªØ li·ªáu th·∫≠t n·∫øu c·∫ßn
            alert(`‚úÖ ƒê·∫∑t mua th√†nh c√¥ng! Xe: ${carName}. T√™n: ${name}. Email: ${email}. Ch√∫ng t√¥i s·∫Ω li√™n h·ªá v·ªõi b·∫°n s·ªõm!`);
            buyPopup.style.display = "none";
            buyForm.reset();
        } else {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß T√™n v√† Email.");
        }
    });

  </script>

  <style>
    body {
      background-color: #111;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
    }
    header { background: #000; padding: 15px; text-align: center; }
    nav a {
      color: gold; margin: 0 10px; text-decoration: none; font-weight: bold;
    }
    nav a:hover { color: white; }
/* ===== CHI TI·∫æT XE V·ª™A ƒê·ª¶ M√ÄN H√åNH ===== */
/* ===== TO√ÄN TRANG ===== */
html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: #000;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden; /* ·∫®n cu·ªôn ƒë·ªÉ gi·ªØ ƒë√∫ng khung */
}

/* ===== KHUNG CHI TI·∫æT XE ===== */
.detail-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 60px;
  width: 75%;
  height: 80vh;
  margin: auto;
  border-radius: 25px;
  background: radial-gradient(circle at top left, #141414 0%, #000 100%);
  box-shadow: 0 0 40px rgba(255, 215, 0, 0.15), inset 0 0 25px rgba(255, 215, 0, 0.05);
  border: 1.5px solid rgba(255, 215, 0, 0.25);
  transition: all 0.4s ease;
}

/* Khi hover ‚Äì hi·ªáu ·ª©ng s√°ng nh·∫π xung quanh */
.detail-container:hover {
  box-shadow: 0 0 55px rgba(255, 215, 0, 0.3), inset 0 0 40px rgba(255, 215, 0, 0.08);
}

/* ===== ·∫¢NH XE ===== */
.detail-container img {
  width: 45%;
  max-width: 600px;
  border-radius: 25px;
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.2);
  object-fit: cover;
  transition: transform 0.4s ease;
}

.detail-container img:hover {
  transform: scale(1.03);
}

/* ===== TH√îNG TIN ===== */
.info {
  flex: 1;
  max-width: 600px;
}

.info h2 {
  font-size: 2.3rem;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 15px;
}

.info p {
  font-size: 1.05rem;
  color: #ddd;
  line-height: 1.8;
  margin-bottom: 10px;
}

.info b {
  color: #ffd700;
}

/* ===== RESPONSIVE (ƒëi·ªán tho·∫°i) ===== */
@media (max-width: 992px) {
  .detail-container {
    flex-direction: column;
    height: auto;
    width: 95%;
    padding: 30px 20px;
  }

  .detail-container img {
    width: 100%;
    max-width: 400px;
  }

  .info h2 {
    font-size: 1.8rem;
  }
}

/* ===== POPUP (Modal) STYLE ===== */
.modal {
  display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
  animation: fadeIn 0.3s;
}

.modal-content {
  background-color: #1b1b1b;
  margin: 15% auto; /* ƒê·∫∑t ·ªü gi·ªØa m√†n h√¨nh */
  padding: 30px;
  border: 1px solid gold;
  width: 80%;
  max-width: 450px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
}

.close-btn {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close-btn:hover,
.close-btn:focus {
  color: gold;
  text-decoration: none;
  cursor: pointer;
}

.modal-content h3 {
    color: gold;
    margin-top: 0;
    border-bottom: 2px solid #333;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.modal-content span {
    font-weight: bold;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #ddd;
}

.form-group input {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #222;
    color: white;
    box-sizing: border-box;
}

.btn-buy-confirm {
    width: 100%;
    padding: 10px;
    background: gold;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 15px;
}

.btn-buy-confirm:hover {
    background: #fff;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
  </style>
</body>
</html>